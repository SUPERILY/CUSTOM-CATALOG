(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[133],{399:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/CategoryManager",function(){return a(845)}])},7969:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(1462).Z)("list",[["path",{d:"M3 5h.01",key:"18ugdj"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 19h.01",key:"noohij"}],["path",{d:"M8 5h13",key:"1pao27"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 19h13",key:"m83p4d"}]])},5809:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(1462).Z)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]])},845:function(e,t,a){"use strict";a.r(t),a.d(t,{CategoryManager:function(){return m}});var r=a(5893),s=a(7294),n=a(1227),i=a(7969),d=a(5197),c=a(8453),o=a(5809),l=a(8154),u=a(3416),g=a(5451);let m=()=>{let[e,t]=(0,s.useState)([]),[a,m]=(0,s.useState)([]),[y,p]=(0,s.useState)(!0),[h,x]=(0,s.useState)(""),[f,w]=(0,s.useState)(!1),[b,v]=(0,s.useState)(null),[k,S]=(0,s.useState)(""),N=async()=>{p(!0);let[e,a]=await Promise.all([n.DB.getCategories(),n.DB.getProducts()]);t(e),m(a),p(!1)};(0,s.useEffect)(()=>{N()},[]);let j=async a=>{if(a.preventDefault(),!h.trim())return;w(!0);let r={id:crypto.randomUUID(),name:h.trim(),displayOrder:e.length,createdAt:new Date,updatedAt:new Date};await n.DB.saveCategory(r),t([...e,r]),x(""),w(!1)},C=e=>{v(e.id),S(e.name)},B=()=>{v(null),S("")},O=async r=>{let s=e.find(e=>e.id===r);if(s&&k.trim()&&(t(e.map(e=>e.id===r?{...e,name:k.trim()}:e)),v(null),await n.DB.saveCategory({id:r,name:k.trim(),displayOrder:s.displayOrder}),s.name!==k.trim())){let e=a.filter(e=>e.category.name===s.name);e.length>0&&(await Promise.all(e.map(e=>n.DB.saveProduct({id:e.id,name:e.name,sku:e.sku,price:e.price,hidePrice:e.hidePrice,description:e.description,stockStatus:e.stockStatus,categoryId:e.categoryId,features:e.features.map(e=>e.text),images:e.images.map(e=>e.url)}))),m(await n.DB.getProducts()))}},M=async(r,s)=>{let i=a.filter(e=>e.category.name===s).length;window.confirm(i>0?"Warning: ".concat(i," product(s) are in this category. Deleting it will leave them uncategorized (or keep the old tag). Continue?"):"Are you sure you want to delete this category?")&&(await n.DB.deleteCategory(r),t(e.filter(e=>e.id!==r)))};return(0,r.jsxs)("div",{className:"space-y-6 max-w-4xl mx-auto",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"bg-indigo-100 p-2 rounded-lg",children:(0,r.jsx)(i.Z,{className:"w-6 h-6 text-indigo-600"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Category Management"}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Manage product categories and organize your catalog."})]})]}),(0,r.jsxs)("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-100",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Add New Category"}),(0,r.jsxs)("form",{onSubmit:j,className:"flex gap-3",children:[(0,r.jsx)("input",{type:"text",placeholder:"Enter category name (e.g., Office Supplies)",className:"flex-grow px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",value:h,onChange:e=>x(e.target.value)}),(0,r.jsxs)("button",{type:"submit",disabled:f||!h.trim(),className:"px-6 py-2 bg-indigo-600 text-white font-medium rounded-lg hover:bg-indigo-700 disabled:opacity-50 flex items-center gap-2 transition-colors",children:[f?(0,r.jsx)(d.Z,{className:"w-4 h-4 animate-spin"}):(0,r.jsx)(c.Z,{className:"w-4 h-4"}),"Add"]})]})]}),(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden",children:[(0,r.jsx)("div",{className:"p-4 bg-gray-50 border-b border-gray-100",children:(0,r.jsxs)("h3",{className:"font-semibold text-gray-700",children:["Existing Categories (",e.length,")"]})}),y?(0,r.jsx)("div",{className:"p-8 flex justify-center",children:(0,r.jsx)(d.Z,{className:"w-8 h-8 text-indigo-600 animate-spin"})}):0===e.length?(0,r.jsx)("div",{className:"p-8 text-center text-gray-500",children:"No categories found. Create one above to get started."}):(0,r.jsx)("ul",{className:"divide-y divide-gray-100",children:e.map(e=>{let t=a.filter(t=>t.category.name===e.name).length,s=b===e.id;return(0,r.jsx)("li",{className:"p-4 hover:bg-gray-50 transition-colors",children:(0,r.jsx)("div",{className:"flex items-center justify-between gap-4",children:s?(0,r.jsxs)("div",{className:"flex-grow flex items-center gap-3",children:[(0,r.jsx)("input",{type:"text",value:k,onChange:e=>S(e.target.value),className:"flex-grow px-3 py-1.5 border border-indigo-300 rounded-md focus:ring-2 focus:ring-indigo-500",autoFocus:!0}),(0,r.jsx)("button",{onClick:()=>O(e.id),className:"p-2 text-green-600 hover:bg-green-50 rounded-md",title:"Save",children:(0,r.jsx)(o.Z,{className:"w-4 h-4"})}),(0,r.jsx)("button",{onClick:B,className:"p-2 text-gray-400 hover:bg-gray-100 rounded-md",title:"Cancel",children:(0,r.jsx)(l.Z,{className:"w-4 h-4"})})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("span",{className:"font-medium text-gray-800",children:e.name}),(0,r.jsxs)("span",{className:"text-xs px-2 py-1 bg-gray-100 text-gray-500 rounded-full",children:[t," products"]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("button",{onClick:()=>C(e),className:"p-2 text-gray-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-md transition-colors",title:"Edit Name",children:(0,r.jsx)(u.Z,{className:"w-4 h-4"})}),(0,r.jsx)("button",{onClick:()=>M(e.id,e.name),className:"p-2 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-md transition-colors",title:"Delete",children:(0,r.jsx)(g.Z,{className:"w-4 h-4"})})]})]})})},e.id)})})]})]})}},1227:function(e,t,a){"use strict";let r;a.d(t,{DB:function(){return s}}),r=new(a(385)).PrismaClient;let s={getProducts:async()=>await r.product.findMany({orderBy:{name:"asc"},include:{images:!0,category:!0,features:!0}}),getProductById:async e=>await r.product.findUnique({where:{id:e},include:{images:!0,category:!0,features:!0}}),saveProduct:async e=>{let{id:t,categoryId:a,features:s,images:n,...i}=e,d=s.map(e=>({text:e})),c=n.map(e=>({url:e}));return t?await r.$transaction(async e=>(await e.feature.deleteMany({where:{productId:t}}),await e.image.deleteMany({where:{productId:t}}),e.product.update({where:{id:t},data:{...i,category:{connect:{id:a}},features:{create:d},images:{create:c}},include:{images:!0,category:!0,features:!0}}))):await r.product.create({data:{...i,category:{connect:{id:a}},features:{create:d},images:{create:c}},include:{images:!0,category:!0,features:!0}})},deleteProduct:async e=>{await r.product.delete({where:{id:e}})},duplicateProduct:async e=>{let t=await r.product.findUnique({where:{id:e},include:{images:!0,category:!0,features:!0}});if(!t)throw Error("Product not found");let a="".concat(t.sku,"-COPY"),s=1;for(;await r.product.findFirst({where:{sku:a}});)a="".concat(t.sku,"-COPY").concat(s),s++;return await r.product.create({data:{name:"".concat(t.name," (Copy)"),sku:a,description:t.description,price:t.price,hidePrice:t.hidePrice,stockStatus:t.stockStatus,category:{connect:{id:t.categoryId}},features:{create:t.features.map(e=>({text:e.text}))},images:{create:t.images.map(e=>({url:e.url}))}},include:{images:!0,category:!0,features:!0}})},getCategories:async()=>r.category.findMany({orderBy:{displayOrder:"asc"}}),saveCategory:async e=>e.id?r.category.update({where:{id:e.id},data:e}):r.category.create({data:e}),deleteCategory:async e=>{await r.category.delete({where:{id:e}})},getBanners:async()=>r.banner.findMany({orderBy:{displayOrder:"asc"}}),getBannerById:async e=>r.banner.findUnique({where:{id:e}}),createBanner:async e=>r.banner.create({data:e}),updateBanner:async(e,t)=>r.banner.update({where:{id:e},data:t}),deleteBanner:async e=>{await r.banner.delete({where:{id:e}})},getBanner:async()=>{let e=await r.banner.findMany({where:{isActive:!0},orderBy:{displayOrder:"asc"},take:1});return e.length>0?e[0]:r.banner.create({data:{title:"Welcome to the Catalog",subtitle:"Explore our products.",imageUrl:"https://picsum.photos/seed/banner/1200/400",linkText:"Explore",linkUrl:"#catalog",isActive:!0,displayOrder:0}})},saveBanner:async e=>{var t,a;let s=await r.banner.findFirst({orderBy:{displayOrder:"asc"}});return s?r.banner.update({where:{id:s.id},data:e}):r.banner.create({data:{title:e.title||"",subtitle:e.subtitle||"",imageUrl:e.imageUrl||"",mobileImageUrl:e.mobileImageUrl||null,linkText:e.linkText||"",linkUrl:e.linkUrl||"",isActive:null===(t=e.isActive)||void 0===t||t,displayOrder:null!==(a=e.displayOrder)&&void 0!==a?a:0}})},async getStockStatuses(){return 0===await r.stockStatus.count()&&await this.seedStockStatuses(),r.stockStatus.findMany({orderBy:{label:"asc"}})},createStockStatus:async e=>r.stockStatus.create({data:{...e,isDefault:!1}}),updateStockStatus:async(e,t)=>r.stockStatus.update({where:{id:e},data:t}),deleteStockStatus:async e=>r.stockStatus.delete({where:{id:e}}),async seedStockStatuses(){for(let e of[{label:"In Stock",value:"IN_STOCK",color:"green"},{label:"Low Stock",value:"LOW_STOCK",color:"yellow"},{label:"Out of Stock",value:"OUT_OF_STOCK",color:"red"},{label:"Backorder",value:"BACKORDER",color:"orange"}])await r.stockStatus.upsert({where:{value:e.value},update:{},create:{label:e.label,value:e.value,color:e.color,isDefault:!0}})},async getStoreSettings(){let e=await r.storeSettings.findUnique({where:{id:"default"}});return e||(e=await r.storeSettings.create({data:{id:"default",storeName:"Eljarjini Complexe"}})),e},async updateStoreSettings(e){return await this.getStoreSettings(),r.storeSettings.update({where:{id:"default"},data:e})}}}},function(e){e.O(0,[737,888,774,179],function(){return e(e.s=399)}),_N_E=e.O()}]);