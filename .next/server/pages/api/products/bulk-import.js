"use strict";(()=>{var e={};e.id=178,e.ids=[178],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,a){return a in t?t[a]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,a)):"function"==typeof t&&"default"===a?t:void 0}}})},9003:(e,t,a)=>{a.r(t),a.d(t,{config:()=>p,default:()=>l,routeModule:()=>g});var r={};a.r(r),a.d(r,{default:()=>u});var s=a(1802),i=a(7153),n=a(6249),o=a(7982);let d=["IN_STOCK","LOW_STOCK","OUT_OF_STOCK","BACKORDER"];class c{constructor(e,t){this.categories=e,this.existingSkus=new Set(t.map(e=>e.sku))}validateRow(e,t){let a=[];e.name&&""!==e.name.trim()||a.push({row:t,field:"name",message:"Product name is required"}),e.sku&&""!==e.sku.trim()||a.push({row:t,field:"sku",message:"SKU is required"}),e.description&&""!==e.description.trim()||a.push({row:t,field:"description",message:"Description is required"}),e.category&&""!==e.category.trim()?this.categories.some(t=>t.name.toLowerCase()===e.category.toLowerCase())||a.push({row:t,field:"category",message:`Category "${e.category}" does not exist. Available: ${this.categories.map(e=>e.name).join(", ")}`}):a.push({row:t,field:"category",message:"Category is required"});let r="string"==typeof e.price?parseFloat(e.price):e.price;if((isNaN(r)||r<0)&&a.push({row:t,field:"price",message:"Price must be a valid positive number"}),e.stockStatus){let r=e.stockStatus.toUpperCase().replace(/\s+/g,"_");d.includes(r)||a.push({row:t,field:"stockStatus",message:`Invalid stock status. Must be one of: ${d.join(", ")}`})}return a}validateAll(e){let t=[],a=[],r=new Set;return e.forEach((e,s)=>{let i=this.validateRow(e,s+1);t.push(...i),e.sku&&(r.has(e.sku)&&t.push({row:s+1,field:"sku",message:`Duplicate SKU "${e.sku}" found in import file`}),r.add(e.sku),this.existingSkus.has(e.sku)&&a.push({row:s+1,field:"sku",message:`SKU "${e.sku}" already exists and will be updated`}))}),{valid:0===t.length,errors:t,warnings:a}}}async function u(e,t){if("POST"!==e.method)return t.status(405).json({error:"Method not allowed"});try{let{rows:a,updateExisting:r=!0}=e.body;if(!a||!Array.isArray(a))return t.status(400).json({error:"Invalid request body. Expected array of rows."});let[s,i]=await Promise.all([o.DB.getCategories(),o.DB.getProducts()]),n=new c(s,i).validateAll(a);if(!n.valid)return t.status(400).json({success:!1,errors:n.errors,warnings:n.warnings});let d={created:0,updated:0,failed:0,errors:[]};for(let e=0;e<a.length;e++){let t=a[e];try{let a=s.find(e=>e.name.toLowerCase()===t.category.toLowerCase());if(!a)continue;let n=i.find(e=>e.sku===t.sku),c=t.features?t.features.split(/[,\n]/).map(e=>e.trim()).filter(e=>e.length>0):[],u=t.images?t.images.split(",").map(e=>e.trim()).filter(e=>e.length>0):[],l=t.stockStatus?.toUpperCase().replace(/\s+/g,"_")||"IN_STOCK",p="string"==typeof t.hidePrice?"true"===t.hidePrice.toLowerCase()||"1"===t.hidePrice:!!t.hidePrice,g={id:n?.id,name:t.name.trim(),sku:t.sku.trim(),price:"string"==typeof t.price?parseFloat(t.price):t.price,hidePrice:p,description:t.description.trim(),categoryId:a.id,features:c,images:u,stockStatus:l};n&&r?(await o.DB.saveProduct(g),d.updated++):n?(d.failed++,d.errors.push({row:e+1,message:`SKU ${t.sku} already exists (update mode disabled)`})):(await o.DB.saveProduct(g),d.created++)}catch(t){d.failed++,d.errors.push({row:e+1,message:t instanceof Error?t.message:"Unknown error"})}}return t.status(200).json({success:!0,results:d,warnings:n.warnings})}catch(e){return console.error("Bulk import error:",e),t.status(500).json({error:"Internal server error",message:e instanceof Error?e.message:"Unknown error"})}}let l=(0,n.l)(r,"default"),p=(0,n.l)(r,"config"),g=new s.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/products/bulk-import",pathname:"/api/products/bulk-import",bundlePath:"",filename:""},userland:r})},7982:(e,t,a)=>{let r;a.d(t,{DB:()=>s}),r=new(require("@prisma/client")).PrismaClient;let s={getProducts:async()=>await r.product.findMany({orderBy:{name:"asc"},include:{images:!0,category:!0,features:!0}}),getProductById:async e=>await r.product.findUnique({where:{id:e},include:{images:!0,category:!0,features:!0}}),saveProduct:async e=>{let{id:t,categoryId:a,features:s,images:i,...n}=e,o=s.map(e=>({text:e})),d=i.map(e=>({url:e}));return t?await r.$transaction(async e=>(await e.feature.deleteMany({where:{productId:t}}),await e.image.deleteMany({where:{productId:t}}),e.product.update({where:{id:t},data:{...n,category:{connect:{id:a}},features:{create:o},images:{create:d}},include:{images:!0,category:!0,features:!0}}))):await r.product.create({data:{...n,category:{connect:{id:a}},features:{create:o},images:{create:d}},include:{images:!0,category:!0,features:!0}})},deleteProduct:async e=>{await r.product.delete({where:{id:e}})},duplicateProduct:async e=>{let t=await r.product.findUnique({where:{id:e},include:{images:!0,category:!0,features:!0}});if(!t)throw Error("Product not found");let a=`${t.sku}-COPY`,s=1;for(;await r.product.findFirst({where:{sku:a}});)a=`${t.sku}-COPY${s}`,s++;return await r.product.create({data:{name:`${t.name} (Copy)`,sku:a,description:t.description,price:t.price,hidePrice:t.hidePrice,stockStatus:t.stockStatus,category:{connect:{id:t.categoryId}},features:{create:t.features.map(e=>({text:e.text}))},images:{create:t.images.map(e=>({url:e.url}))}},include:{images:!0,category:!0,features:!0}})},getCategories:async()=>r.category.findMany({orderBy:{displayOrder:"asc"}}),saveCategory:async e=>e.id?r.category.update({where:{id:e.id},data:e}):r.category.create({data:e}),deleteCategory:async e=>{await r.category.delete({where:{id:e}})},getBanners:async()=>r.banner.findMany({orderBy:{displayOrder:"asc"}}),getBannerById:async e=>r.banner.findUnique({where:{id:e}}),createBanner:async e=>r.banner.create({data:e}),updateBanner:async(e,t)=>r.banner.update({where:{id:e},data:t}),deleteBanner:async e=>{await r.banner.delete({where:{id:e}})},getBanner:async()=>{let e=await r.banner.findMany({where:{isActive:!0},orderBy:{displayOrder:"asc"},take:1});return e.length>0?e[0]:r.banner.create({data:{title:"Welcome to the Catalog",subtitle:"Explore our products.",imageUrl:"https://picsum.photos/seed/banner/1200/400",linkText:"Explore",linkUrl:"#catalog",isActive:!0,displayOrder:0}})},saveBanner:async e=>{let t=await r.banner.findFirst({orderBy:{displayOrder:"asc"}});return t?r.banner.update({where:{id:t.id},data:e}):r.banner.create({data:{title:e.title||"",subtitle:e.subtitle||"",imageUrl:e.imageUrl||"",mobileImageUrl:e.mobileImageUrl||null,linkText:e.linkText||"",linkUrl:e.linkUrl||"",isActive:e.isActive??!0,displayOrder:e.displayOrder??0}})},async getStockStatuses(){return 0===await r.stockStatus.count()&&await this.seedStockStatuses(),r.stockStatus.findMany({orderBy:{label:"asc"}})},createStockStatus:async e=>r.stockStatus.create({data:{...e,isDefault:!1}}),updateStockStatus:async(e,t)=>r.stockStatus.update({where:{id:e},data:t}),deleteStockStatus:async e=>r.stockStatus.delete({where:{id:e}}),async seedStockStatuses(){for(let e of[{label:"In Stock",value:"IN_STOCK",color:"green"},{label:"Low Stock",value:"LOW_STOCK",color:"yellow"},{label:"Out of Stock",value:"OUT_OF_STOCK",color:"red"},{label:"Backorder",value:"BACKORDER",color:"orange"}])await r.stockStatus.upsert({where:{value:e.value},update:{},create:{label:e.label,value:e.value,color:e.color,isDefault:!0}})},async getStoreSettings(){let e=await r.storeSettings.findUnique({where:{id:"default"}});return e||(e=await r.storeSettings.create({data:{id:"default",storeName:"Eljarjini Complexe"}})),e},async updateStoreSettings(e){return await this.getStoreSettings(),r.storeSettings.update({where:{id:"default"},data:e})}}},7153:(e,t)=>{var a;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return a}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(a||(a={}))},1802:(e,t,a)=>{e.exports=a(145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var a=t(t.s=9003);module.exports=a})();