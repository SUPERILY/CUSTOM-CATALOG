"use strict";(()=>{var e={};e.id=480,e.ids=[480],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,a){return a in t?t[a]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,a)):"function"==typeof t&&"default"===a?t:void 0}}})},3613:(e,t,a)=>{a.r(t),a.d(t,{config:()=>u,default:()=>i,routeModule:()=>l});var r={};a.r(r),a.d(r,{default:()=>c});var o=a(1802),s=a(7153),n=a(6249),d=a(7982);async function c(e,t){let{id:a}=e.query;if("string"!=typeof a)return t.status(400).json({error:"Invalid ID"});if("GET"===e.method)try{let e=await d.DB.getProductById(a);if(!e)return t.status(404).json({error:"Product not found"});t.status(200).json(e)}catch(e){console.error("GET product error:",e),t.status(500).json({error:"Failed to fetch product"})}else if("POST"===e.method)try{console.log("POST /api/products/new - Creating new product"),console.log("Request body:",JSON.stringify(e.body,null,2));let{id:a,...r}=e.body,o=await d.DB.saveProduct(r);console.log("Product created successfully:",o.id),t.status(201).json(o)}catch(a){console.error("POST product error:",a);let e=a instanceof Error?a.message:"Failed to create product";t.status(500).json({error:e})}else if("PUT"===e.method)try{console.log(`PUT /api/products/${a} - Updating product`);let r=await d.DB.saveProduct({...e.body,id:a});console.log("Product updated successfully:",r.id),t.status(200).json(r)}catch(a){console.error("PUT product error:",a);let e=a instanceof Error?a.message:"Failed to update product";t.status(500).json({error:e})}else if("DELETE"===e.method)try{await d.DB.deleteProduct(a),t.status(204).end()}catch(e){console.error("DELETE product error:",e),t.status(500).json({error:"Failed to delete product"})}else t.setHeader("Allow",["GET","POST","PUT","DELETE"]),t.status(405).end(`Method ${e.method} Not Allowed`)}let i=(0,n.l)(r,"default"),u=(0,n.l)(r,"config"),l=new o.PagesAPIRouteModule({definition:{kind:s.x.PAGES_API,page:"/api/products/[id]",pathname:"/api/products/[id]",bundlePath:"",filename:""},userland:r})},7982:(e,t,a)=>{let r;a.d(t,{DB:()=>o}),r=new(require("@prisma/client")).PrismaClient;let o={getProducts:async()=>await r.product.findMany({orderBy:{name:"asc"},include:{images:!0,category:!0,features:!0}}),getProductById:async e=>await r.product.findUnique({where:{id:e},include:{images:!0,category:!0,features:!0}}),saveProduct:async e=>{let{id:t,categoryId:a,features:o,images:s,...n}=e,d=o.map(e=>({text:e})),c=s.map(e=>({url:e}));return t?await r.$transaction(async e=>(await e.feature.deleteMany({where:{productId:t}}),await e.image.deleteMany({where:{productId:t}}),e.product.update({where:{id:t},data:{...n,category:{connect:{id:a}},features:{create:d},images:{create:c}},include:{images:!0,category:!0,features:!0}}))):await r.product.create({data:{...n,category:{connect:{id:a}},features:{create:d},images:{create:c}},include:{images:!0,category:!0,features:!0}})},deleteProduct:async e=>{await r.product.delete({where:{id:e}})},duplicateProduct:async e=>{let t=await r.product.findUnique({where:{id:e},include:{images:!0,category:!0,features:!0}});if(!t)throw Error("Product not found");let a=`${t.sku}-COPY`,o=1;for(;await r.product.findFirst({where:{sku:a}});)a=`${t.sku}-COPY${o}`,o++;return await r.product.create({data:{name:`${t.name} (Copy)`,sku:a,description:t.description,price:t.price,hidePrice:t.hidePrice,stockStatus:t.stockStatus,category:{connect:{id:t.categoryId}},features:{create:t.features.map(e=>({text:e.text}))},images:{create:t.images.map(e=>({url:e.url}))}},include:{images:!0,category:!0,features:!0}})},getCategories:async()=>r.category.findMany({orderBy:{displayOrder:"asc"}}),saveCategory:async e=>e.id?r.category.update({where:{id:e.id},data:e}):r.category.create({data:e}),deleteCategory:async e=>{await r.category.delete({where:{id:e}})},getBanners:async()=>r.banner.findMany({orderBy:{displayOrder:"asc"}}),getBannerById:async e=>r.banner.findUnique({where:{id:e}}),createBanner:async e=>r.banner.create({data:e}),updateBanner:async(e,t)=>r.banner.update({where:{id:e},data:t}),deleteBanner:async e=>{await r.banner.delete({where:{id:e}})},getBanner:async()=>{let e=await r.banner.findMany({where:{isActive:!0},orderBy:{displayOrder:"asc"},take:1});return e.length>0?e[0]:r.banner.create({data:{title:"Welcome to the Catalog",subtitle:"Explore our products.",imageUrl:"https://picsum.photos/seed/banner/1200/400",linkText:"Explore",linkUrl:"#catalog",isActive:!0,displayOrder:0}})},saveBanner:async e=>{let t=await r.banner.findFirst({orderBy:{displayOrder:"asc"}});return t?r.banner.update({where:{id:t.id},data:e}):r.banner.create({data:{title:e.title||"",subtitle:e.subtitle||"",imageUrl:e.imageUrl||"",mobileImageUrl:e.mobileImageUrl||null,linkText:e.linkText||"",linkUrl:e.linkUrl||"",isActive:e.isActive??!0,displayOrder:e.displayOrder??0}})},async getStockStatuses(){return 0===await r.stockStatus.count()&&await this.seedStockStatuses(),r.stockStatus.findMany({orderBy:{label:"asc"}})},createStockStatus:async e=>r.stockStatus.create({data:{...e,isDefault:!1}}),updateStockStatus:async(e,t)=>r.stockStatus.update({where:{id:e},data:t}),deleteStockStatus:async e=>r.stockStatus.delete({where:{id:e}}),async seedStockStatuses(){for(let e of[{label:"In Stock",value:"IN_STOCK",color:"green"},{label:"Low Stock",value:"LOW_STOCK",color:"yellow"},{label:"Out of Stock",value:"OUT_OF_STOCK",color:"red"},{label:"Backorder",value:"BACKORDER",color:"orange"}])await r.stockStatus.upsert({where:{value:e.value},update:{},create:{label:e.label,value:e.value,color:e.color,isDefault:!0}})},async getStoreSettings(){let e=await r.storeSettings.findUnique({where:{id:"default"}});return e||(e=await r.storeSettings.create({data:{id:"default",storeName:"Eljarjini Complexe"}})),e},async updateStoreSettings(e){return await this.getStoreSettings(),r.storeSettings.update({where:{id:"default"},data:e})}}},7153:(e,t)=>{var a;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return a}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(a||(a={}))},1802:(e,t,a)=>{e.exports=a(145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var a=t(t.s=3613);module.exports=a})();