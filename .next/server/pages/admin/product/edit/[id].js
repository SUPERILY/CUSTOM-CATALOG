"use strict";(()=>{var e={};e.id=530,e.ids=[530,660],e.modules={1323:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,a){return a in t?t[a]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,a)):"function"==typeof t&&"default"===a?t:void 0}}})},7714:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.r(t),a.d(t,{config:()=>h,default:()=>g,getServerSideProps:()=>y,getStaticPaths:()=>m,getStaticProps:()=>p,reportWebVitals:()=>x,routeModule:()=>j,unstable_getServerProps:()=>v,unstable_getServerSideProps:()=>S,unstable_getStaticParams:()=>w,unstable_getStaticPaths:()=>b,unstable_getStaticProps:()=>f});var s=a(7093),i=a(5244),o=a(1323),l=a(2899),d=a.n(l),n=a(6814),c=a(7935),u=e([n,c]);[n,c]=u.then?(await u)():u;let g=(0,o.l)(c,"default"),p=(0,o.l)(c,"getStaticProps"),m=(0,o.l)(c,"getStaticPaths"),y=(0,o.l)(c,"getServerSideProps"),h=(0,o.l)(c,"config"),x=(0,o.l)(c,"reportWebVitals"),f=(0,o.l)(c,"unstable_getStaticProps"),b=(0,o.l)(c,"unstable_getStaticPaths"),w=(0,o.l)(c,"unstable_getStaticParams"),v=(0,o.l)(c,"unstable_getServerProps"),S=(0,o.l)(c,"unstable_getServerSideProps"),j=new s.PagesRouteModule({definition:{kind:i.x.PAGES,page:"/admin/product/edit/[id]",pathname:"/admin/product/edit/[id]",bundlePath:"",filename:""},components:{App:n.default,Document:d()},userland:c});r()}catch(e){r(e)}})},5875:(e,t,a)=>{a.d(t,{Z:()=>r});let r=(0,a(1462).Z)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},7886:(e,t,a)=>{a.d(t,{Z:()=>r});let r=(0,a(1462).Z)("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]])},5197:(e,t,a)=>{a.d(t,{Z:()=>r});let r=(0,a(1462).Z)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},8453:(e,t,a)=>{a.d(t,{Z:()=>r});let r=(0,a(1462).Z)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},5809:(e,t,a)=>{a.d(t,{Z:()=>r});let r=(0,a(1462).Z)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]])},7935:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.r(t),a.d(t,{default:()=>w,getServerSideProps:()=>b});var s=a(997),i=a(6689),o=a(1163),l=a(1227),d=a(332),n=a(5875),c=a(8154),u=a(5197),g=a(2770),p=a(8453),m=a(5809),y=a(6619),h=e([d]);d=(h.then?(await h)():h)[0];let x=({product:e,categories:t,stockStatuses:a})=>{let r=(0,o.useRouter)(),[l,y]=(0,i.useState)(!e),[h,x]=(0,i.useState)({name:e?.name||"",sku:e?.sku||"",price:e?.price||0,hidePrice:e?.hidePrice||!1,description:e?.description||"",stockStatus:e?.stockStatus||(a.length>0?a[0].value:"IN_STOCK"),categoryId:e?.categoryId||(t.length>0?t[0].id:""),features:e?.features.map(e=>e.text)||[""],images:e?.images.map(e=>e.url)||[]}),[f,b]=(0,i.useState)(!1),[w,v]=(0,i.useState)(!1),S=async e=>{let t=e.target.files?.[0];if(t){if(!t.type.startsWith("image/")){d.C.error("Please upload an image file");return}if(t.size>10485760){d.C.error("Image size must be less than 10MB");return}v(!0);try{let e=new FormData;e.append("file",t);let a=await fetch("/api/upload",{method:"POST",body:e});if(!a.ok)throw Error("Upload failed");let r=await a.json();x(e=>({...e,images:[...e.images,r.url]})),d.C.success("Image uploaded successfully")}catch(e){console.error("Image upload error:",e),d.C.error("Failed to upload image")}finally{v(!1),e.target.value=""}}},j=e=>{x(t=>({...t,images:t.images.filter((t,a)=>a!==e)}))},k=async t=>{if(t.preventDefault(),0===h.images.length){d.C.error("Please upload at least one product image");return}b(!0);try{let t=l?{...h}:{...h,id:e?.id};console.log("Saving product:",{isNew:l,productData:t});let a=l?"/api/products/new":`/api/products/${e?.id}`,s=await fetch(a,{method:l?"POST":"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok){let e=await s.json().catch(()=>({error:"Unknown error"}));throw console.error("API Error Response:",e),Error(e.error||"Failed to save product")}let i=await s.json();console.log("Product saved successfully:",i),d.C.success(l?"Product created successfully":"Product updated successfully"),r.push("/admin/products")}catch(e){console.error("Failed to save product:",e),d.C.error(e instanceof Error?e.message:"Failed to save product"),b(!1)}},P=(e,t)=>{let a=[...h.features];a[e]=t,x({...h,features:a})},N=e=>x({...h,features:h.features.filter((t,a)=>a!==e)});return(0,s.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4 mb-6",children:[s.jsx("button",{onClick:()=>r.push("/admin/products"),className:"text-gray-500 hover:text-gray-700",children:s.jsx(n.Z,{className:"w-6 h-6"})}),s.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:l?"Add New Product":"Edit Product"})]}),(0,s.jsxs)("form",{onSubmit:k,className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 sm:p-8 space-y-8",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Product Name *"}),s.jsx("input",{required:!0,type:"text",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",value:h.name,onChange:e=>x({...h,name:e.target.value})})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"SKU *"}),s.jsx("input",{required:!0,type:"text",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",value:h.sku,onChange:e=>x({...h,sku:e.target.value})})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Category *"}),s.jsx("select",{className:"w-full px-4 py-2 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",value:h.categoryId,onChange:e=>x({...h,categoryId:e.target.value}),children:t.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Price ($) *"}),(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3",children:[s.jsx("input",{required:!0,type:"number",step:"0.01",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",value:h.price,onChange:e=>x({...h,price:parseFloat(e.target.value)||0})}),(0,s.jsxs)("label",{className:"flex items-center gap-2 text-sm text-gray-600 whitespace-nowrap select-none cursor-pointer",children:[s.jsx("input",{type:"checkbox",checked:h.hidePrice,onChange:e=>x({...h,hidePrice:e.target.checked}),className:"rounded text-indigo-600 focus:ring-indigo-500 w-4 h-4"}),"Hide Price"]})]})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Description"}),s.jsx("textarea",{rows:4,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",value:h.description,onChange:e=>x({...h,description:e.target.value})})]}),(0,s.jsxs)("div",{className:"space-y-3",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Product Images *"}),h.images.length>0&&s.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 mb-4",children:h.images.map((e,t)=>(0,s.jsxs)("div",{className:"relative group aspect-square rounded-lg overflow-hidden border-2 border-gray-200",children:[s.jsx("img",{src:e,alt:`Product ${t+1}`,className:"w-full h-full object-cover"}),s.jsx("button",{type:"button",onClick:()=>j(t),className:"absolute top-2 right-2 p-1.5 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity shadow-lg hover:bg-red-600",children:s.jsx(c.Z,{className:"w-4 h-4"})}),0===t&&s.jsx("div",{className:"absolute bottom-2 left-2 px-2 py-1 bg-indigo-600 text-white text-xs rounded font-medium",children:"Primary"})]},t))}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsxs)("label",{className:"flex items-center gap-2 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 cursor-pointer transition-colors border border-gray-300",children:[s.jsx("input",{type:"file",accept:"image/*",onChange:S,disabled:w,className:"hidden"}),w?(0,s.jsxs)(s.Fragment,{children:[s.jsx(u.Z,{className:"w-4 h-4 animate-spin"}),s.jsx("span",{children:"Uploading..."})]}):(0,s.jsxs)(s.Fragment,{children:[s.jsx(g.Z,{className:"w-4 h-4"}),s.jsx("span",{children:"Upload Image"})]})]}),s.jsx("span",{className:"text-sm text-gray-500",children:"Max 10MB, JPG/PNG/WEBP"})]})]}),(0,s.jsxs)("div",{className:"space-y-3",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Key Features"}),h.features.map((e,t)=>(0,s.jsxs)("div",{className:"flex gap-2",children:[s.jsx("input",{type:"text",className:"flex-grow px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",value:e,onChange:e=>P(t,e.target.value),placeholder:"Enter a feature"}),s.jsx("button",{type:"button",onClick:()=>N(t),className:"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-lg",children:s.jsx(c.Z,{className:"w-5 h-5"})})]},t)),(0,s.jsxs)("button",{type:"button",onClick:()=>x({...h,features:[...h.features,""]}),className:"flex items-center gap-2 text-sm text-indigo-600 hover:text-indigo-800 font-medium",children:[s.jsx(p.Z,{className:"w-4 h-4"})," Add Feature"]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Stock Status *"}),s.jsx("div",{className:"flex gap-4 flex-wrap",children:a.map(e=>(0,s.jsxs)("label",{className:`flex items-center gap-2 px-4 py-2 rounded-lg border cursor-pointer transition-all ${h.stockStatus===e.value?"bg-indigo-50 border-indigo-500 text-indigo-700":"bg-white border-gray-200 hover:bg-gray-50"}`,children:[s.jsx("input",{type:"radio",name:"stockStatus",value:e.value,checked:h.stockStatus===e.value,onChange:e=>x({...h,stockStatus:e.target.value}),className:"text-indigo-600 focus:ring-indigo-500"}),s.jsx("span",{className:`w-2 h-2 rounded-full bg-${e.color}-500`,style:{backgroundColor:e.color.startsWith("#")?e.color:void 0}}),e.label]},e.id))})]}),(0,s.jsxs)("div",{className:"pt-6 border-t flex justify-end gap-4",children:[s.jsx("button",{type:"button",onClick:()=>r.push("/admin/products"),className:"px-6 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 font-medium",children:"Cancel"}),(0,s.jsxs)("button",{type:"submit",disabled:f||w,className:"px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 shadow-md font-medium flex items-center gap-2 disabled:opacity-70 disabled:cursor-not-allowed",children:[f&&s.jsx(u.Z,{className:"w-4 h-4 animate-spin"}),s.jsx(m.Z,{className:"w-4 h-4"}),"Save Product"]})]})]})]})};x.getLayout=function(e){return s.jsx(y.AdminLayout,{children:e})};let f=e=>JSON.parse(JSON.stringify(e,(e,t)=>t instanceof Date?t.toISOString():t)),b=async e=>{let{id:t}=e.params,a=await l.DB.getCategories(),r=await l.DB.getStockStatuses();if("new"===t)return{props:{categories:f(a),stockStatuses:f(r)}};let s=await l.DB.getProductById(t);return s?{props:{product:f(s),categories:f(a),stockStatuses:f(r)}}:{notFound:!0}},w=x;r()}catch(e){r(e)}})},1227:(e,t,a)=>{let r;a.d(t,{DB:()=>s}),r=new(a(3524)).PrismaClient;let s={getProducts:async()=>await r.product.findMany({orderBy:{name:"asc"},include:{images:!0,category:!0,features:!0}}),getProductById:async e=>await r.product.findUnique({where:{id:e},include:{images:!0,category:!0,features:!0}}),saveProduct:async e=>{let{id:t,categoryId:a,features:s,images:i,...o}=e,l=s.map(e=>({text:e})),d=i.map(e=>({url:e}));return t?await r.$transaction(async e=>(await e.feature.deleteMany({where:{productId:t}}),await e.image.deleteMany({where:{productId:t}}),e.product.update({where:{id:t},data:{...o,category:{connect:{id:a}},features:{create:l},images:{create:d}},include:{images:!0,category:!0,features:!0}}))):await r.product.create({data:{...o,category:{connect:{id:a}},features:{create:l},images:{create:d}},include:{images:!0,category:!0,features:!0}})},deleteProduct:async e=>{await r.product.delete({where:{id:e}})},duplicateProduct:async e=>{let t=await r.product.findUnique({where:{id:e},include:{images:!0,category:!0,features:!0}});if(!t)throw Error("Product not found");let a=`${t.sku}-COPY`,s=1;for(;await r.product.findFirst({where:{sku:a}});)a=`${t.sku}-COPY${s}`,s++;return await r.product.create({data:{name:`${t.name} (Copy)`,sku:a,description:t.description,price:t.price,hidePrice:t.hidePrice,stockStatus:t.stockStatus,category:{connect:{id:t.categoryId}},features:{create:t.features.map(e=>({text:e.text}))},images:{create:t.images.map(e=>({url:e.url}))}},include:{images:!0,category:!0,features:!0}})},getCategories:async()=>r.category.findMany({orderBy:{displayOrder:"asc"}}),saveCategory:async e=>e.id?r.category.update({where:{id:e.id},data:e}):r.category.create({data:e}),deleteCategory:async e=>{await r.category.delete({where:{id:e}})},getBanners:async()=>r.banner.findMany({orderBy:{displayOrder:"asc"}}),getBannerById:async e=>r.banner.findUnique({where:{id:e}}),createBanner:async e=>r.banner.create({data:e}),updateBanner:async(e,t)=>r.banner.update({where:{id:e},data:t}),deleteBanner:async e=>{await r.banner.delete({where:{id:e}})},getBanner:async()=>{let e=await r.banner.findMany({where:{isActive:!0},orderBy:{displayOrder:"asc"},take:1});return e.length>0?e[0]:r.banner.create({data:{title:"Welcome to the Catalog",subtitle:"Explore our products.",imageUrl:"https://picsum.photos/seed/banner/1200/400",linkText:"Explore",linkUrl:"#catalog",isActive:!0,displayOrder:0}})},saveBanner:async e=>{let t=await r.banner.findFirst({orderBy:{displayOrder:"asc"}});return t?r.banner.update({where:{id:t.id},data:e}):r.banner.create({data:{title:e.title||"",subtitle:e.subtitle||"",imageUrl:e.imageUrl||"",mobileImageUrl:e.mobileImageUrl||null,linkText:e.linkText||"",linkUrl:e.linkUrl||"",isActive:e.isActive??!0,displayOrder:e.displayOrder??0}})},async getStockStatuses(){return 0===await r.stockStatus.count()&&await this.seedStockStatuses(),r.stockStatus.findMany({orderBy:{label:"asc"}})},createStockStatus:async e=>r.stockStatus.create({data:{...e,isDefault:!1}}),updateStockStatus:async(e,t)=>r.stockStatus.update({where:{id:e},data:t}),deleteStockStatus:async e=>r.stockStatus.delete({where:{id:e}}),async seedStockStatuses(){for(let e of[{label:"In Stock",value:"IN_STOCK",color:"green"},{label:"Low Stock",value:"LOW_STOCK",color:"yellow"},{label:"Out of Stock",value:"OUT_OF_STOCK",color:"red"},{label:"Backorder",value:"BACKORDER",color:"orange"}])await r.stockStatus.upsert({where:{value:e.value},update:{},create:{label:e.label,value:e.value,color:e.color,isDefault:!0}})},async getStoreSettings(){let e=await r.storeSettings.findUnique({where:{id:"default"}});return e||(e=await r.storeSettings.create({data:{id:"default",storeName:"Eljarjini Complexe"}})),e},async updateStoreSettings(e){return await this.getStoreSettings(),r.storeSettings.update({where:{id:"default"},data:e})}}},5244:(e,t)=>{var a;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return a}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(a||(a={}))},3524:e=>{e.exports=require("@prisma/client")},2785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},6689:e=>{e.exports=require("react")},6405:e=>{e.exports=require("react-dom")},997:e=>{e.exports=require("react/jsx-runtime")},6201:e=>{e.exports=import("react-hot-toast")},7147:e=>{e.exports=require("fs")},1017:e=>{e.exports=require("path")},2781:e=>{e.exports=require("stream")},9796:e=>{e.exports=require("zlib")}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[567,48,899,238],()=>a(7714));module.exports=r})();